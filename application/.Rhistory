install.packages(c("splines", "ggnewscale","MASS","coda"))
install.packages("httpgd")
?use
use("LaplacesDemon", rpareto)
use("LaplacesDemon", laplace)
use("LaplacesDemon", dlaplace)
use("LaplacesDemon", dexp)
use("LaplacesDemon", dexp())
use("cmdstanr", install_cmdstan)
library(cmdstanr)
re
remove.packages("qqboxplot")
getwd()
devtools::install('qqboxplot.tgz')
install.packages("devtools")
devtools::install('qqboxplot.tgz')
devtools::install('/qqboxplot.tgz')
install.packages("qqboxplot.tgz", repos = NULL, type="source")
library(npreg)
library(Pareto)
suppressMessages(library(tidyverse))
library(readxl)
library(gridExtra)
library(VGAM)
library(evgam)
# Structure of the FWI System
#DSR : Daily Severity Rating
#FWI : Fire Weather Index
#BUI : Buildup Index
#ISI : Initial Spread Index
#FFMC : Fine FUel Moisture Code
#DMC : Duff Moisture Code
#DC : Drought Code
setwd("C:/Users/Johnny Lee/Documents/GitHub")
# setwd("A:/GitHub")
load("./BLAST/application/wildfire_prep.Rdata") #loading covariate-dependent thresholds
psi <- 30
u <- quantile(Y, 0.975)
y <- Y[which(Y>u)]
fwi.scaled <- fwi.origin[which(Y>u),c(1:7)]
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
fwi.scaled <- as.data.frame(sapply(fwi.scaled, FUN = range01))
n <- dim(fwi.scaled)[[1]]
p <- dim(fwi.scaled)[[2]]
fwi.df <- data.frame(fwi.scaled, BA=y)
evgam.df <- data.frame(fwi.scaled, BA=y-u)
xholder <- data.frame(matrix(nrow=n, ncol=p))
for(i in 1:p){
xholder[,i] <- seq(min(fwi.scaled[,i]), max(fwi.scaled[,i]), length.out = n)
}
colnames(xholder) <- colnames(fwi.scaled)
vgam.fit.scale <- vgam(BA ~ s(DSR) + s(FWI) + s(BUI) + s(ISI) + s(FFMC) + s(DMC) + s(DC),
data = fwi.df,
family = gpd(threshold = u,
lshape="loglink",
zero = NULL),
trace = TRUE,
control = vgam.control(maxit = 200))
# par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
# plot(vgam.fit.scale, se = TRUE, shade = TRUE, shcol = "steelblue")
# par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.scale, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.scale, newdata = data.frame(xholder), type = "terms")
vgam.scale.response <- predict(vgam.fit.scale, type = "link")
vgam.xi.scale <- exp(fitted.linear[,2])
vgam.fit.1 <- vgam(BA ~ s(DSR) + s(FWI) + s(BUI) + s(ISI) + s(FFMC) + s(DMC) + s(DC),
data = fwi.df,
family = gpd(threshold = u,
lshape="loglink",
zero = 1),
trace = TRUE,
control = vgam.control(maxit = 200))
par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
plot(vgam.fit.1, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.1, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.1, newdata = data.frame(xholder), type = "terms")
vgam.1.response <- predict(vgam.fit.1,type="link")
vgam.xi.1 <- exp(fitted.linear[,2])
vgam.fit.xi <- vgam(BA ~ s(DSR) + s(FWI) + s(BUI) + s(ISI) + s(FFMC) + s(DMC) + s(DC),
data = fwi.df,
family = gpd(threshold = u,
lshape="loglink",
zero = 2),
trace = TRUE,
control = vgam.control(maxit = 200))
par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
plot(vgam.fit.xi, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.xi, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.xi, newdata = data.frame(xholder), type = "terms")
fitted.response <- predict(vgam.fit.xi, newdata = data.frame(xholder), type = "response")
vgam.fit.linear <- vgam(BA ~ .,
data = fwi.df,
family = gpd(threshold = u,
lshape="loglink",
zero = NULL),
trace = TRUE,
control = vgam.control(maxit = 200))
par(mfrow = c(2, 4), mar=c(4,3,3,4))
plot(vgam.fit.linear, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "terms")
fitted.response <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "response")
gam.scale <- list(BA ~ s(DSR,  bs = "tp", k = 30) +
s(FWI,  bs = "tp", k = 30) +
s(BUI,  bs = "tp", k = 30) +
s(ISI,  bs = "tp", k = 30) +
s(FFMC, bs = "tp", k = 30) +
s(DMC,  bs = "tp", k = 30) +
s(DC,   bs = "tp", k = 30),
~ s(DSR,  bs = "tp", k = 30) +
s(FWI,  bs = "tp", k = 30) +
s(BUI,  bs = "tp", k = 30) +
s(ISI,  bs = "tp", k = 30) +
s(FFMC, bs = "tp", k = 30) +
s(DMC,  bs = "tp", k = 30) +
s(DC,   bs = "tp", k = 30))
evgam.fit.scale <- evgam::evgam(gam.scale, dat = evgam.df, family = "gpd")
evgam.xi.scale <- predict(evgam.fit.scale, newdata = data.frame(xholder), type="response")$shape
evgam.scale.response <- predict(evgam.fit.scale, type = "response")
xholder.basis.scale <- predict(evgam.fit.scale, newdata = data.frame(xholder), type= "lpmatrix")$shape
xi.coef.scale <- tail(evgam.fit.scale$coefficients, (psi-1)*p)
gamma.xi.scale <- matrix(xi.coef.scale, ncol = p)
alpha.nonlinear.scale <- xi.nonlinear.scale <- matrix(, nrow = n, ncol = p)
bs.nonlinear.scale <- xholder.basis.scale[,c(2:((psi-1)*p+1))]
for(j in 1:p){
xi.nonlinear.scale[,j] <- bs.nonlinear.scale[,(((j-1)*(psi-1))+1):(((j-1)*(psi-1))+(psi-1))] %*% gamma.xi.scale[,j]
alpha.nonlinear.scale[,j] <- 1/(xi.nonlinear.scale[,j])
}
gam.1 <- list(BA ~ 1,
~ s(DSR,  bs = "tp", k = 30) +
s(FWI,  bs = "tp", k = 30) +
s(BUI,  bs = "tp", k = 30) +
s(ISI,  bs = "tp", k = 30) +
s(FFMC, bs = "tp", k = 30) +
s(DMC,  bs = "tp", k = 30) +
s(DC,   bs = "tp", k = 30))
evgam.fit.1 <- evgam::evgam(gam.1, data = evgam.df, family = "gpd")
evgam.xi.1 <-predict(evgam.fit.1, newdata = data.frame(xholder), type="response")$shape
evgam.alpha.1 <- 1/evgam.xi.1
evgam.1.response <- predict(evgam.fit.1, type = "response")
xholder.basis.1 <- predict(evgam.fit.1, newdata = data.frame(xholder), type= "lpmatrix")$shape
xi.coef.1 <- tail(evgam.fit.1$coefficients, (psi-1)*p)
gamma.xi.1 <- matrix(xi.coef.1, ncol = p)
alpha.nonlinear.1 <- xi.nonlinear.1 <- matrix(, nrow = n, ncol = p)
bs.nonlinear.1 <- xholder.basis.1[,c(2:((psi-1)*p+1))]
for(j in 1:p){
xi.nonlinear.1[,j] <- bs.nonlinear.1[,(((j-1)*(psi-1))+1):(((j-1)*(psi-1))+(psi-1))] %*% gamma.xi.1[,j]
alpha.nonlinear.1[,j] <- 1/(xi.nonlinear.1[,j])
}
par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
plot(vgam.fit.linear, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "terms")
fitted.response <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "response")
fitted.response <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "response")
plot(vgam.fit.linear, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
plot(vgam.fit.linear, se = TRUE, shade = TRUE, shcol = "steelblue")
vgam.fit.linear <- vgam(BA ~ .,
data = fwi.df,
family = gpd(threshold = u,
lshape="loglink",
zero = NULL),
trace = TRUE,
control = vgam.control(maxit = 200))
par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
plot(vgam.fit.linear, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "terms")
fitted.response <- predict(vgam.fit.linear, newdata = data.frame(xholder), type = "response")
gam.1 <- list(BA ~ 1,
~ s(DSR,  bs = "tp", k = 30) +
s(FWI,  bs = "tp", k = 30) +
s(BUI,  bs = "tp", k = 30) +
s(ISI,  bs = "tp", k = 30) +
s(FFMC, bs = "tp", k = 30) +
s(DMC,  bs = "tp", k = 30) +
s(DC,   bs = "tp", k = 30))
evgam.fit.1 <- evgam::evgam(gam.1, data = evgam.df, family = "gpd")
evgam.xi.1 <-predict(evgam.fit.1, newdata = data.frame(xholder), type="response")$shape
evgam.alpha.1 <- 1/evgam.xi.1
evgam.1.response <- predict(evgam.fit.1, type = "response")
xholder.basis.1 <- predict(evgam.fit.1, newdata = data.frame(xholder), type= "lpmatrix")$shape
xi.coef.1 <- tail(evgam.fit.1$coefficients, (psi-1)*p)
gamma.xi.1 <- matrix(xi.coef.1, ncol = p)
alpha.nonlinear.1 <- xi.nonlinear.1 <- matrix(, nrow = n, ncol = p)
bs.nonlinear.1 <- xholder.basis.1[,c(2:((psi-1)*p+1))]
for(j in 1:p){
xi.nonlinear.1[,j] <- bs.nonlinear.1[,(((j-1)*(psi-1))+1):(((j-1)*(psi-1))+(psi-1))] %*% gamma.xi.1[,j]
alpha.nonlinear.1[,j] <- 1/(xi.nonlinear.1[,j])
}
vgam.fit.scale <- vgam(BA ~ s(DSR) + s(FWI) + s(BUI) + s(ISI) + s(FFMC) + s(DMC) + s(DC),
data = fwi.df,
family = gpd(threshold = u,
lshape="loglink",
zero = NULL),
trace = TRUE,
control = vgam.control(maxit = 200))
par(mfrow = c(2, 4), mar=c(1.75,1.75,1.75,1.75))
plot(vgam.fit.scale, se = TRUE, shade = TRUE, shcol = "steelblue")
par(mfrow = c(1, 1))
fitted.linear <- predict(vgam.fit.scale, newdata = data.frame(xholder), type = "link")
fitted.terms <- predict(vgam.fit.scale, newdata = data.frame(xholder), type = "terms")
vgam.scale.response <- predict(vgam.fit.scale, type = "link")
vgam.xi.scale <- exp(fitted.linear[,2])
load("./BLAST/application/blast.Rdata")
setwd("~/GitHub")
load("./BLAST/application/blast.Rdata")
setwd("~/GitHub/BLAST")
load("./BLAST/application/blast.Rdata")
getwd()
setwd("~/GitHub/BLAST/application")
load("./BLAST/application/blast.Rdata")
setwd("~/GitHub/BLAST/application")
load("blast.Rdata")
xi.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = as.vector(vgam.xi.1),
"vgam.scale" = as.vector(vgam.xi.scale),
"evgam.1" = as.vector(evgam.xi.1),
"evgam.scale" = as.vector(evgam.xi.scale),
"post.mean" = 1/data.scenario$post.mean,
"post.median" = 1/data.scenario$post.median,
"q1" = 1/data.scenario$q1,
"q3" = 1/data.scenario$q3)
ggplot(xi.scenario, aes(x=x)) +
ylab(expression(xi(c,ldots,c))) + xlab(expression(c)) + labs(col = "") +
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 30) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 20))
alpha.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = 1/as.vector(vgam.xi.1),
"vgam.scale" = 1/as.vector(vgam.xi.scale),
"evgam.1" = 1/as.vector(evgam.xi.1),
"evgam.scale" = 1/as.vector(evgam.xi.scale),
"post.mean" = data.scenario$post.mean,
"post.median" = data.scenario$post.median,
"q1" = data.scenario$q1,
"q3" = data.scenario$q3)
ggplot(alpha.scenario, aes(x=x)) +
ylab(expression(alpha(c,ldots,c))) + xlab(expression(c)) + labs(col = "") + ylim(0,14.5)+
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 30) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 20))
alpha.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = 1/as.vector(vgam.xi.1),
"vgam.scale" = 1/as.vector(vgam.xi.scale),
"evgam.1" = 1/as.vector(evgam.xi.1),
"evgam.scale" = 1/as.vector(evgam.xi.scale),
"post.mean" = data.scenario$post.mean,
"post.median" = data.scenario$post.median,
"q1" = data.scenario$q1,
"q3" = data.scenario$q3)
ggplot(alpha.scenario, aes(x=x)) +
ylab(expression(alpha(c,ldots,c))) + xlab(expression(c)) + labs(col = "") + ylim(0,14.5)+
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 30) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 10))
alpha.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = 1/as.vector(vgam.xi.1),
"vgam.scale" = 1/as.vector(vgam.xi.scale),
"evgam.1" = 1/as.vector(evgam.xi.1),
"evgam.scale" = 1/as.vector(evgam.xi.scale),
"post.mean" = data.scenario$post.mean,
"post.median" = data.scenario$post.median,
"q1" = data.scenario$q1,
"q3" = data.scenario$q3)
ggplot(alpha.scenario, aes(x=x)) +
ylab(expression(alpha(c,ldots,c))) + xlab(expression(c)) + labs(col = "") + ylim(0,14.5)+
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 30) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 5))
alpha.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = 1/as.vector(vgam.xi.1),
"vgam.scale" = 1/as.vector(vgam.xi.scale),
"evgam.1" = 1/as.vector(evgam.xi.1),
"evgam.scale" = 1/as.vector(evgam.xi.scale),
"post.mean" = data.scenario$post.mean,
"post.median" = data.scenario$post.median,
"q1" = data.scenario$q1,
"q3" = data.scenario$q3)
ggplot(alpha.scenario, aes(x=x)) +
ylab(expression(alpha(c,ldots,c))) + xlab(expression(c)) + labs(col = "") + ylim(0,14.5)+
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 30) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 1))
alpha.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = 1/as.vector(vgam.xi.1),
"vgam.scale" = 1/as.vector(vgam.xi.scale),
"evgam.1" = 1/as.vector(evgam.xi.1),
"evgam.scale" = 1/as.vector(evgam.xi.scale),
"post.mean" = data.scenario$post.mean,
"post.median" = data.scenario$post.median,
"q1" = data.scenario$q1,
"q3" = data.scenario$q3)
ggplot(alpha.scenario, aes(x=x)) +
ylab(expression(alpha(c,ldots,c))) + xlab(expression(c)) + labs(col = "") + ylim(0,14.5)+
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 5) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 20))
alpha.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = 1/as.vector(vgam.xi.1),
"vgam.scale" = 1/as.vector(vgam.xi.scale),
"evgam.1" = 1/as.vector(evgam.xi.1),
"evgam.scale" = 1/as.vector(evgam.xi.scale),
"post.mean" = data.scenario$post.mean,
"post.median" = data.scenario$post.median,
"q1" = data.scenario$q1,
"q3" = data.scenario$q3)
ggplot(alpha.scenario, aes(x=x)) +
ylab(expression(alpha(c,ldots,c))) + xlab(expression(c)) + labs(col = "") + ylim(0,14.5)+
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 10) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 10))
xi.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = as.vector(vgam.xi.1),
"vgam.scale" = as.vector(vgam.xi.scale),
"evgam.1" = as.vector(evgam.xi.1),
"evgam.scale" = as.vector(evgam.xi.scale),
"post.mean" = 1/data.scenario$post.mean,
"post.median" = 1/data.scenario$post.median,
"q1" = 1/data.scenario$q1,
"q3" = 1/data.scenario$q3)
ggplot(xi.scenario, aes(x=x)) +
ylab(expression(xi(c,ldots,c))) + xlab(expression(c)) + labs(col = "") +
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 10) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 10))
r.vgam.1 <- r.vgam.scale <- r.evgam.1 <- r.evgam.scale <- c()
for(i in 1:n){
r.vgam.1[i] <- qnorm(evd::pgpd(y[i], scale = exp(vgam.1.response[i,1]), loc = u, shape = exp(vgam.1.response[i,2])))
r.vgam.scale[i] <- qnorm(evd::pgpd(y[i], scale = exp(vgam.scale.response[i,1]), loc = u, shape = exp(vgam.scale.response[i,2])))
r.evgam.1[i] <- qnorm(evd::pgpd(y[i], scale = exp(evgam.1.response$scale[i]), loc = u, shape = evgam.1.response$shape[i]))
r.evgam.scale[i] <- qnorm(evd::pgpd(y[i], scale = evgam.scale.response$scale[i], loc = u, shape = evgam.scale.response$shape[i]))
}
lgrid <- n
quantile.prob <- ppoints(lgrid)
grid <- qnorm(quantile.prob)
# traj.vgam.1 <- traj.vgam.scale <- traj.evgam.1 <- traj.evgam.scale <- c()
qqplot.df$traj.vgam.1 <- quantile(r.vgam.1, quantile.prob, type = 2)
qqplot.df$traj.vgam.scale <- quantile(r.vgam.scale, quantile.prob, type = 2)
qqplot.df$traj.evgam.1 <- quantile(r.evgam.1, quantile.prob, type = 2)
qqplot.df$traj.evgam.scale <- quantile(r.evgam.scale, quantile.prob, type = 2)
ggplot(data = qqplot.df, aes(x=grid)) +
geom_ribbon(aes(ymin = l.band, ymax = u.band),
fill = "steelblue",
alpha = 0.4, linetype = "dashed") +
geom_line(aes(y = trajhat), colour = "steelblue", linetype = "dashed", linewidth = 1.2) +
geom_line(aes(y = traj.vgam.1), colour = "orange", linewidth=1.1) +
geom_line(aes(y = traj.vgam.scale), colour = "purple", linewidth=1.1) +
geom_line(aes(y = traj.evgam.1), colour = "orange", linetype = 3, linewidth=1.1) +
geom_line(aes(y = traj.evgam.scale), colour = "purple", linetype = 3, linewidth=1.1) +
geom_abline(intercept = 0, slope = 1, linewidth = 1.2) +
labs(x = "Theoretical quantiles", y = "Sample quantiles") +
theme_minimal(base_size = 10) +
theme(axis.text = element_text(size = 10)) +
coord_fixed(xlim = c(-3, 3),
ylim = c(-3, 3))
xi.scenario <- data.frame("x" = xholder[,1],
"vgam.1" = as.vector(vgam.xi.1),
"vgam.scale" = as.vector(vgam.xi.scale),
"evgam.1" = as.vector(evgam.xi.1),
"evgam.scale" = as.vector(evgam.xi.scale),
"post.mean" = 1/data.scenario$post.mean,
"post.median" = 1/data.scenario$post.median,
"q1" = 1/data.scenario$q1,
"q3" = 1/data.scenario$q3)
ggplot(xi.scenario, aes(x=x)) +
ylab(expression(xi(c,ldots,c))) + xlab(expression(c)) + labs(col = "") +
geom_ribbon(aes(ymin = q1, ymax = q3, fill="Credible Band"), alpha = 0.2) +
geom_line(aes(y=post.median, col = "Posterior Median"), linewidth=1) +
geom_line(aes(y=vgam.1), linewidth=1, color = "orange") +
geom_line(aes(y=vgam.scale), linewidth=1, color = "purple") +
geom_line(aes(y=evgam.1), linewidth=1, color = "orange", linetype=3) +
geom_line(aes(y=evgam.scale), linewidth=1, color = "purple", linetype=3) +
scale_fill_manual(values=c("steelblue"), name = "") +
scale_color_manual(values = c("steelblue")) +
guides(color = guide_legend(order = 2),
fill = guide_legend(order = 1)) +
theme_minimal(base_size = 30) +
theme(legend.position = "none",
strip.text = element_blank(),
axis.text = element_text(size = 20))
r.vgam.1 <- r.vgam.scale <- r.evgam.1 <- r.evgam.scale <- c()
for(i in 1:n){
r.vgam.1[i] <- qnorm(evd::pgpd(y[i], scale = exp(vgam.1.response[i,1]), loc = u, shape = exp(vgam.1.response[i,2])))
r.vgam.scale[i] <- qnorm(evd::pgpd(y[i], scale = exp(vgam.scale.response[i,1]), loc = u, shape = exp(vgam.scale.response[i,2])))
r.evgam.1[i] <- qnorm(evd::pgpd(y[i], scale = evgam.1.response$scale[i], loc = u, shape = evgam.1.response$shape[i]))
r.evgam.scale[i] <- qnorm(evd::pgpd(y[i], scale = evgam.scale.response$scale[i], loc = u, shape = evgam.scale.response$shape[i]))
}
lgrid <- n
quantile.prob <- ppoints(lgrid)
grid <- qnorm(quantile.prob)
# traj.vgam.1 <- traj.vgam.scale <- traj.evgam.1 <- traj.evgam.scale <- c()
qqplot.df$traj.vgam.1 <- quantile(r.vgam.1, quantile.prob, type = 2)
qqplot.df$traj.vgam.scale <- quantile(r.vgam.scale, quantile.prob, type = 2)
qqplot.df$traj.evgam.1 <- quantile(r.evgam.1, quantile.prob, type = 2)
qqplot.df$traj.evgam.scale <- quantile(r.evgam.scale, quantile.prob, type = 2)
ggplot(data = qqplot.df, aes(x=grid)) +
geom_ribbon(aes(ymin = l.band, ymax = u.band),
fill = "steelblue",
alpha = 0.4, linetype = "dashed") +
geom_line(aes(y = trajhat), colour = "steelblue", linetype = "dashed", linewidth = 1.2) +
geom_line(aes(y = traj.vgam.1), colour = "orange", linewidth=1.1) +
geom_line(aes(y = traj.vgam.scale), colour = "purple", linewidth=1.1) +
geom_line(aes(y = traj.evgam.1), colour = "orange", linetype = 3, linewidth=1.1) +
geom_line(aes(y = traj.evgam.scale), colour = "purple", linetype = 3, linewidth=1.1) +
geom_abline(intercept = 0, slope = 1, linewidth = 1.2) +
labs(x = "Theoretical quantiles", y = "Sample quantiles") +
theme_minimal(base_size = 10) +
theme(axis.text = element_text(size = 10)) +
coord_fixed(xlim = c(-3, 3),
ylim = c(-3, 3))
str(evgam.fit.1)
install.packages("nearpde")
install.packages("nearPD")
library(Matrix)
Matrix::nearPD()
Matrix::nearPD
?nearPD
